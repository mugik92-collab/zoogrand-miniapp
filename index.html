<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ZooGrand — Товары и передержка</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <style>
        @keyframes fadeInUp { from { opacity:0; transform:translateY(20px); } to { opacity:1; transform:translateY(0); } }
        .animate-fadeInUp { animation:fadeInUp 0.6s ease-out forwards; }

        :root {
            --bg:#f8f9fa; --card:#ffffff; --text:#2d2d2d; --accent:#ff9800; --accent-dark:#e67e22;
            --green:#4caf50; --gray:#666; --danger:#e74c3c; --shadow:0 4px 16px rgba(0,0,0,0.08);
        }
        [data-theme="dark"] { --bg:#111; --card:#1e1e1e; --text:#e0e0e0; --gray:#aaa; }

        body { font-family:system-ui,sans-serif; margin:0; padding:0; background:var(--bg); color:var(--text); min-height:100vh; }
        header { background:linear-gradient(135deg,var(--accent),var(--accent-dark)); color:white; text-align:center; padding:1.2rem; font-size:1.5rem; font-weight:700; box-shadow:0 2px 10px rgba(0,0,0,0.2); }
        .container { padding:1rem; }
        .category-grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(140px,1fr)); gap:1rem; margin:1.5rem 0; }
        .category-card { background:var(--card); border-radius:16px; padding:1.5rem 1rem; text-align:center; box-shadow:var(--shadow); cursor:pointer; transition:all 0.25s; }
        .category-card:hover { transform:translateY(-6px); box-shadow:0 12px 24px rgba(0,0,0,0.12); }
        .category-card i { font-size:2.8rem; margin-bottom:0.8rem; color:var(--accent); }
        .category-card div { font-weight:600; font-size:1.1rem; }

        .subcategory-grid { display:grid; grid-template-columns:1fr; gap:1.2rem; margin:1.5rem 0; }
        .subcategory-card { background:var(--card); border-radius:16px; overflow:hidden; box-shadow:var(--shadow); transition:transform 0.25s; cursor:pointer; }
        .subcategory-card:hover { transform:translateY(-6px); }
        .subcategory-img { width:100%; height:180px; object-fit:cover; }
        .subcategory-content { padding:1rem; }
        .price { color:var(--accent); font-weight:700; font-size:1.3rem; margin:0.5rem 0; }
        .desc { color:var(--gray); line-height:1.45; font-size:0.95rem; white-space:pre-wrap; }

        .qty-control { display:flex; align-items:center; gap:1rem; margin:1rem 0; justify-content:center; }
        .qty-btn { width:44px; height:44px; border-radius:50%; background:#eee; border:none; font-size:1.4rem; cursor:pointer; }
        .qty-input { width:70px; text-align:center; font-size:1.2rem; padding:0.6rem; border:1px solid #ddd; border-radius:10px; }
        .add-btn { background:var(--green); color:white; border:none; padding:0.9rem; border-radius:12px; font-size:1.1rem; font-weight:600; cursor:pointer; width:100%; margin-top:0.8rem; }

        #cart-bar { position:fixed; bottom:0; left:0; right:0; background:var(--card); box-shadow:0 -4px 16px rgba(0,0,0,0.15); padding:0.8rem 1rem; display:flex; justify-content:space-between; align-items:center; z-index:100; font-weight:600; }
        #clearCartBtn { background:var(--danger); color:white; border:none; padding:0.6rem 1.2rem; border-radius:10px; cursor:pointer; font-size:0.95rem; }

        #cartList { margin:1rem 0; padding-bottom:5rem; }
        .cart-item { background:var(--card); border-radius:12px; padding:1rem; margin-bottom:1rem; box-shadow:var(--shadow); }
        .cart-item-title { font-weight:600; margin-bottom:0.4rem; }
        .cart-item-details { color:var(--gray); font-size:0.95rem; }
        .cart-item-total { font-weight:700; color:var(--accent); margin-top:0.6rem; display:block; }

        .back-btn { background:#e0e0e0; color:#333; border:none; padding:0.8rem 1.4rem; border-radius:12px; cursor:pointer; font-weight:600; margin-bottom:1rem; }
        .hidden { display:none !important; }

        #orderModal { position:fixed; inset:0; background:rgba(0,0,0,0.65); display:flex; align-items:center; justify-content:center; z-index:200; }
        .modal-content { background:var(--card); border-radius:16px; padding:1.8rem; width:92%; max-width:420px; box-shadow:0 10px 30px rgba(0,0,0,0.3); }
        textarea { width:100%; min-height:110px; padding:0.8rem; border:1px solid #ccc; border-radius:10px; margin:0.8rem 0; font-size:1rem; }
        .modal-buttons { display:flex; gap:1rem; margin-top:1.5rem; }
        .modal-btn { flex:1; padding:0.9rem; border-radius:12px; font-weight:600; cursor:pointer; }
        .confirm { background:var(--accent); color:white; border:none; }
        .cancel { background:#ccc; color:#333; border:none; }

        .date-row { display:flex; flex-direction:column; gap:0.8rem; margin:1.2rem 0; }
        input[type="date"] { padding:0.8rem; font-size:1rem; border:1px solid #ccc; border-radius:10px; }
        .discount { color:#27ae60; font-weight:700; margin-top:0.6rem; font-size:1.05rem; }
    </style>
</head>
<body>

<header>ZooGrand — Товары и передержка</header>

<div class="container">

    <div id="mainScreen">
        <div class="category-grid">
            <div class="category-card animate-fadeInUp" onclick="showCategory('Лежанки')"><i class="fas fa-bed"></i><div>Лежанки</div></div>
            <div class="category-card animate-fadeInUp" onclick="showCategory('Передержка')"><i class="fas fa-paw"></i><div>Передержка</div></div>
            <div class="category-card animate-fadeInUp" onclick="showCategory('Вкусняшки')"><i class="fas fa-bone"></i><div>Вкусняшки</div></div>
        </div>
    </div>

    <div id="categoryScreen" class="hidden">
        <button class="back-btn" onclick="backToMain()">← Назад</button>
        <h2 id="categoryTitle"></h2>

        <div id="subcategoryGrid" class="subcategory-grid"></div>
        <div id="calcPanel" class="hidden">
            <h3 id="calcTitle"></h3>

            <div class="date-row hidden" id="dateFields">
                <label>Заезд:</label><input type="date" id="checkIn">
                <label>Выезд:</label><input type="date" id="checkOut">
            </div>

            <div id="nightsInfo" class="hidden" style="font-size:1.1rem;margin:1rem 0;">
                Суток: <strong id="nightsCount">1</strong> • Сумма: <strong id="calcPrice">0 ₽</strong>
            </div>
            <div id="discountBlock" class="discount hidden">Скидка 10% за 10+ суток!</div>

            <div class="qty-control" id="qtyPanel">
                <button class="qty-btn" onclick="changeQty(-1)">−</button>
                <input type="number" id="qtyInput" value="1" min="1">
                <button class="qty-btn" onclick="changeQty(1)">+</button>
            </div>

            <button class="add-btn" onclick="addToCartFromCalc()">Добавить в корзину</button>
        </div>

        <div id="cartList"></div>
    </div>

</div>

<div id="cart-bar" class="hidden">
    <div>Корзина: <strong id="cartCount">0</strong> • <strong id="cartTotal">0 ₽</strong></div>
    <div>
        <button id="clearCartBtn" onclick="clearCart()">Очистить</button>
        <button id="orderBtn" onclick="showOrderModal()">Оформить</button>
    </div>
</div>

<div id="orderModal" class="hidden">
    <div class="modal-content">
        <h3>Оформление заказа</h3>
        <label>Комментарий / пожелания:</label>
        <textarea id="orderComment" placeholder="Порода, кличка, аллергии, время доставки и т.д..."></textarea>

        <div class="modal-buttons">
            <button class="modal-btn cancel" onclick="closeOrderModal()">Отмена</button>
            <button class="modal-btn confirm" onclick="sendOrder()">Отправить</button>
        </div>
    </div>
</div>

<script>
    const tg = window.Telegram.WebApp;
    tg.ready(); tg.expand();

    if (tg.colorScheme === 'dark') document.documentElement.setAttribute('data-theme', 'dark');

    const products = [
        // Лежанки — 5 подкатегорий
        {id:1, category:"Лежанки", sub:"Лежанка-овал Эконом", price:1400, desc:"60×45 см, бортик 8–12 см\nХоллофайбер, Оксфорд 600D PU\nБюджетная, лёгкая, для мелких собак\nдо 15 кг\nСъёмный чехол: нет\nМашинная стирка: да (целиком)\nВодоотталкивающая пропитка: да\nАнтискользящее дно: да", imageUrl:"https://ir.ozone.ru/s3/multimedia-1/wc1200/6807648889.jpg"},
        {id:2, category:"Лежанки", sub:"Лежанка-пончик Классик", price:1200, desc:"Диаметр 70–100 см, бортик 18–25 см\nХоллофайбер + силикон, Велюр / плюш\nУютная, для зарывания, мелкие–средние\nдо 30 кг\nСъёмный чехол: иногда\nМашинная стирка: только чехол\nВодоотталкивающая: нет\nАнтискользящее дно: да", imageUrl:"https://ir.ozone.ru/s3/multimedia-1/wc1200/6429193313.jpg"},
        {id:3, category:"Лежанки", sub:"Лежанка Ортопед", price:1400, desc:"80×60 – 120×80 см, бортик 12–18 см\nОртопедическая пена HR + холлофайбер\nРип-стоп / флок\nДля суставов, пожилые, средние–крупные\nдо 50 кг\nСъёмный чехол: да\nМашинная стирка: да (чехол)\nВодоотталкивающая: да\nАнтискользящее дно: да\nЦена 3500–9000 руб", imageUrl:"https://ir.ozone.ru/s3/multimedia-1/wc1200/6284927428.jpg"},
        {id:4, category:"Лежанки", sub:"Лежанка-дивана Премиум", price:1500, desc:"90×70 – 130×90 см, бортик 20–30 см\nОртопедическая пена + memory foam\nМикрофибра / замша с тефлоном\nРоскошь, интерьер, крупные\nдо 70 кг\nСъёмный чехол: да\nМашинная стирка: да (чехол)\nВодоотталкивающая: да\nАнтискользящее дно: да\nЦена 5500–15000 руб", imageUrl:"https://ir.ozone.ru/s3/multimedia-1/wc1200/6429193321.jpg"},
        {id:5, category:"Лежанки", sub:"Лежанка-матрас Гигант", price:1600, desc:"120×90 – 160×110 см, бортик 5–10 см или без\nОртопедическая пена 10–15 см\nКордура / баллистический нейлон\nДля гигантов, моется шлангом, вольеры\n45+ кг\nСъёмный чехол: да\nМашинная стирка: да (чехол)\nВодоотталкивающая: да\nАнтискользящее дно: да\nЦена 8000–25000 руб", imageUrl:"https://ir.ozone.ru/s3/multimedia-1/wc1200/6284927435.jpg"},

        // Передержка (6 подкатегорий) — из предыдущей версии
        {id:13, category:"Передержка", sub:"Мини / Той", price:650, desc:"до 28–30 см, до 3–5 кг\nЧихуахуа, йоркширский терьер, русский той-терьер, померанский шпиц (мини/той), мальтезе (мини), пражский крысарик, папильон (маленькие), мопс (мелкие), французский бульдог (очень мелкие)\nМогут жить по 4–8 в одном вольере, мало едят, часто агрессивны к крупным, склонны к травмам, много лают", imageUrl:"https://images.unsplash.com/photo-1617890686219-509e1a05969a"},
        {id:14, category:"Передержка", sub:"Маленькие", price:900, desc:"28–40 см, 5–10(12) кг\nЙоркширский терьер (стандарт), померанский шпиц, ши-тцу, пекинес, мальтезе, той-пудель, кавалер кинг чарльз спаниель, бишон фризе, болоньез, японский хин, миниатюрный шнауцер, брюссельский гриффон\nСовместимы в группах, истеричны при разлуке, требуют частого вычесывания, склонны к зубным проблемам", imageUrl:"https://images.unsplash.com/photo-1583511655857-d19b40a7a54e"},
        {id:15, category:"Передержка", sub:"Маленькие-средние", price:1100, desc:"35–50 см, 10–18 кг\nДжек-рассел-терьер, кокер-спаниель (американский/английский), бигль, бассет-хаунд, шелти (шелтландская овчарка), вельш-корги пемброк/кардиган, миниатюрный/карликовый пудель, басенджи, шиба-ину, такса (стандарт), французский бульдог (средние), бостон-терьер\nВысокая энергия, нуждаются в активном выгуле, много лают/воют, хорошая совместимость", imageUrl:"https://images.unsplash.com/photo-1561037404-61cd46aa615b"},
        {id:16, category:"Передержка", sub:"Средние", price:1300, desc:"40–58 см, 15–28(30) кг\nБультерьер, стаффордширский бультерьер, английский бульдог, бордер-колли, австралийская овчарка, колли (длинношерстная), хаски (мелкие/средние), лабрадор-ретривер (молодые/стройные), золотистый ретривер (стройные), эстонская гончая, английский кокер-спаниель, уиппет, далматин, сибирский хаски (средние), американский кокер-спаниель\nСамая проблемная группа по дракам, высокая возбудимость", imageUrl:"https://images.unsplash.com/photo-1587300003388-59208cc962cb"},
        {id:17, category:"Передержка", sub:"Крупные", price:1900, desc:"58–70 см, 28–45(50) кг\nНемецкая овчарка, лабрадор-ретривер, золотистый ретривер, ротвейлер, доберман, боксёр, ризеншнауцер, алабай (молодые/средние), сибирский хаски (крупные), маламут (средние), кане-корсо (стройные), немецкий дог (стройные), бернский зенненхунд (средние), колли (гладкошерстная), восточно-европейская овчарка\nОтдельный вольер почти всегда, сильный укус, территориальность", imageUrl:"https://images.unsplash.com/photo-1567752881297-894d9ec55f45"},
        {id:18, category:"Передержка", sub:"Очень крупные / Гиганты", price:3500, desc:"70+ см, 45–90+ кг\nКавказская овчарка, среднеазиатская овчарка (алабай взрослый), английский мастиф, немецкий дог, сенбернар, леонбергер, ньюфаундленд, ирландский волкодав, большой швейцарский зенненхунд, тибетский мастиф, кане-корсо (крупные), ротвейлер (очень крупные), московская сторожевая\nТолько отдельный вольер/выгул, огромный расход корма, очень сильные", imageUrl:"https://images.unsplash.com/photo-1561948955-570b270e7c36"}
    ];

    let cart = [];
    let currentItem = null;

    function showCategory(cat) {
        document.getElementById('mainScreen').classList.add('hidden');
        document.getElementById('categoryScreen').classList.remove('hidden');
        document.getElementById('categoryTitle').textContent = cat;

        document.getElementById('subcategoryGrid').classList.remove('hidden');
        document.getElementById('calcPanel').classList.add('hidden');

        renderSubcategories(cat);
        renderCartList();
    }

    function renderSubcategories(category) {
        const grid = document.getElementById('subcategoryGrid');
        grid.innerHTML = '';

        const items = products.filter(p => p.category === category);

        items.forEach((item, i) => {
            const card = document.createElement('div');
            card.className = 'subcategory-card animate-fadeInUp';
            card.style.animationDelay = `${i * 0.1}s`;
            card.innerHTML = `
                <img class="subcategory-img" src="${item.imageUrl}" alt="${item.sub}" onerror="this.src='https://via.placeholder.com/400x180?text=${item.sub}'">
                <div class="subcategory-content">
                    <h3>${item.sub}</h3>
                    <div class="price">${item.price} ₽</div>
                    <div class="desc">${item.desc}</div>
                </div>
            `;
            card.onclick = () => openCalculator(item);
            grid.appendChild(card);
        });
    }

    function openCalculator(item) {
        currentItem = item;
        document.getElementById('subcategoryGrid').classList.add('hidden');
        document.getElementById('calcPanel').classList.remove('hidden');
        document.getElementById('calcTitle').textContent = item.sub;

        const isOverexposure = item.category === 'Передержка';

        document.getElementById('dateFields').classList.toggle('hidden', !isOverexposure);
        document.getElementById('nightsInfo').classList.toggle('hidden', !isOverexposure);
        document.getElementById('qtyPanel').classList.toggle('hidden', isOverexposure);

        if (isOverexposure) {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('checkIn').value = today;
            document.getElementById('checkIn').min = today;
            document.getElementById('checkOut').value = new Date(Date.now() + 86400000).toISOString().split('T')[0];
            document.getElementById('checkOut').min = today;

            updateCalc();
            document.getElementById('checkIn').onchange = updateCalc;
            document.getElementById('checkOut').onchange = updateCalc;
        } else {
            document.getElementById('qtyInput').value = 1;
        }
    }

    function updateCalc() {
        if (currentItem.category !== 'Передержка') return;

        const inD = new Date(document.getElementById('checkIn').value);
        const outD = new Date(document.getElementById('checkOut').value);
        let nights = Math.max(1, Math.ceil((outD - inD) / 86400000));

        let total = nights * currentItem.price;
        let discount = nights >= 10 ? 0.1 : 0;
        let final = total * (1 - discount);

        document.getElementById('nightsCount').textContent = nights;
        document.getElementById('calcPrice').textContent = final.toFixed(0) + ' ₽';
        document.getElementById('discountBlock').classList.toggle('hidden', discount === 0);
    }

    function changeQty(delta) {
        const el = document.getElementById('qtyInput');
        let v = parseInt(el.value) || 1;
        el.value = Math.max(1, v + delta);
    }

    function addToCartFromCalc() {
        if (!currentItem) return;

        const isOver = currentItem.category === 'Передержка';
        let quantity = isOver
            ? parseInt(document.getElementById('nightsCount').textContent)
            : parseInt(document.getElementById('qtyInput').value) || 1;

        const entry = {
            product: currentItem,
            quantity,
            checkIn: isOver ? document.getElementById('checkIn').value : null,
            checkOut: isOver ? document.getElementById('checkOut').value : null
        };

        const exist = cart.find(e => e.product.id === currentItem.id);
        if (exist) exist.quantity += quantity;
        else cart.push(entry);

        tg.showPopup({message: `Добавлено: ${quantity} × ${currentItem.sub}`});
        updateCart();
        renderCartList();
        backToMain();
    }

    function renderCartList() {
        const list = document.getElementById('cartList');
        list.innerHTML = cart.length === 0 ? '<p style="text-align:center;color:var(--gray);">Корзина пуста</p>' : '';

        cart.forEach(item => {
            const div = document.createElement('div');
            div.className = 'cart-item';
            let title = item.product.sub || item.product.name;
            let details = `${item.quantity} шт.`;
            if (item.checkIn) details = `${item.quantity} сут. (${item.checkIn} → ${item.checkOut})`;
            div.innerHTML = `
                <div class="cart-item-title">${title}</div>
                <div class="cart-item-details">${details}</div>
                <span class="cart-item-total">${(item.quantity * item.product.price).toFixed(0)} ₽</span>
            `;
            list.appendChild(div);
        });
    }

    function updateCart() {
        let count = cart.reduce((s, e) => s + e.quantity, 0);
        let total = cart.reduce((s, e) => s + e.quantity * e.product.price, 0);

        document.getElementById('cartCount').textContent = count;
        document.getElementById('cartTotal').textContent = total.toFixed(0) + ' ₽';
        document.getElementById('cart-bar').classList.toggle('hidden', count === 0);
        renderCartList();
    }

    function clearCart() {
        if (confirm('Очистить всю корзину?')) {
            cart = [];
            updateCart();
            tg.showPopup({message: 'Корзина очищена'});
        }
    }

    function backToMain() {
        document.getElementById('categoryScreen').classList.add('hidden');
        document.getElementById('mainScreen').classList.remove('hidden');
    }

    function showOrderModal() {
        document.getElementById('orderModal').classList.remove('hidden');
    }

    function closeOrderModal() {
        document.getElementById('orderModal').classList.add('hidden');
    }

    function sendOrder() {
        const comment = document.getElementById('orderComment').value.trim();
        let text = 'Заказ ZooGrand\n\n';

        cart.forEach(item => {
            let line = `${item.product.sub || item.product.name} × ${item.quantity}`;
            if (item.checkIn) line += ` (${item.checkIn} → ${item.checkOut})`;
            else line += ' шт.';
            text += line + '\n';
        });

        let sum = cart.reduce((s, e) => s + e.quantity * e.product.price, 0);
        text += `\nИтого: ${sum} ₽`;
        if (comment) text += `\n\nКомментарий: ${comment}`;

        tg.sendData(text);
        tg.showAlert('Заказ отправлен! Скоро свяжемся.');
        cart = [];
        updateCart();
        closeOrderModal();
    }

    // Старт
    updateCart();
</script>
</body>
</html>
